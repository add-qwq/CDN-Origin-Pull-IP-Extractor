<!DOCTYPE html>
<!--请勿在未经允许的情况下使用该页面的代码-->
<!--请勿在未经允许的情况下使用该页面的代码-->
<!--该页面版权归Rockaz.top的开发者所有-->
<!--此页代码已开源至GitHub，受到开源协议保护-->
<!--为了更好的让大家使用，所以此页代码使用AI精简了部分，原页面代码由https://www.rockaz.top/CDN-Origin-Pull-IP-Extractor提供-->
<!--我们建议，如果你需要此页代码，请到GitHub页下载，并且在Apache-2.0 许可证的规则下使用，而不是偷-->
<!--
    本页GitHub仓库：https://github.com/add-qwq/CDN-Origin-Pull-IP-Extractor
-->
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDN回源IP日志分析工具</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#4f46e5',
                        neutral: '#f3f4f6',
                        dark: '#1f2937'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .card-shadow { box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
            .transition-custom { transition: all 0.3s ease; }
            .user-select-text { user-select: text; }
        }

        body {
            @apply min-h-screen bg-gray-50 text-gray-800 font-inter;
        }

        .card-button {
            background: linear-gradient(135deg, #2563eb, #4f46e5);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            box-shadow: 0 2px 6px rgba(37, 99, 235, 0.2);
            transition: all 0.3s ease;
        }
        
        .card-button:hover {
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
            transform: translateY(-1px);
        }

        .card {
            @apply bg-white rounded-lg border border-gray-200 transition-custom card-shadow;
        }
        .card:hover { 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .form-input {
            @apply bg-white border border-gray-300 rounded-lg px-4 py-3 w-full focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-custom;
        }
        
        ::placeholder { @apply text-gray-400; }

        ::-webkit-scrollbar {
            width: 6px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="antialiased">

    <header class="bg-white sticky top-0 z-50 shadow-sm border-b border-gray-200">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <h1 class="text-2xl md:text-3xl font-bold tet-primary"><a href="/" class="nav-link">CDN回源IP分析工具</a>
                </h1>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">

        <div class="card p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fa fa-info-circle text-primary mr-2"></i>工具说明
            </h2>
            <p class="text-gray-700 mb-4 leading-relaxed">
                因为大厂CDN的回源ip获取方式一般都需要付费，而很多小厂CDN则根本没有提供，需要我们自己去日志中查找获取<br>
                所以，这是一个日志分析系统，用于获取CDN的回源ip（CDN节点≠CDN回源节点）
            </p>
            <p class="text-gray-700 mb-4 leading-relaxed">
                本工具用于从CDN访问日志中提取回源IP地址，目前支持三种功能：
            </p>
            <ul class="list-disc pl-8 text-gray-700 space-y-2">
                <li>雷池WAF访问日志（日志路径：防护应用>应用详情>应用日志）：直接提取每行第一个IP地址作为回源IP</li>
                <li>NCSA标准格式日志：分析提取所有相似前缀的IP段（适用于阿里云ESA等），会识别多个可能的回源IP段</li>
                <li>IP转Nginx配置：将分析结果转换为Nginx的set_real_ip_from配置格式</li>
            </ul>
        </div>

        <div class="mb-8">
            <div class="flex border-b border-gray-200 mb-6">
                <button id="tab-leichi"
                    class="px-6 py-3 font-bold text-primary border-b-2 border-primary transition-custom">
                    雷池WAF日志
                </button>
                <button id="tab-ncsa" class="px-6 py-3 font-medium text-gray-500 hover:text-primary transition-custom">
                    NCSA标准日志
                </button>
                <button id="tab-nginx" class="px-6 py-3 font-medium text-gray-500 hover:text-primary transition-custom">
                    IP转Nginx配置
                </button>
            </div>

            <div id="leichi-content" class="card p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-700">输入日志内容</label>
                    <textarea id="leichi-log" rows="8" class="form-input resize-vertical"
                        placeholder="粘贴雷池WAF访问日志内容..."></textarea>
                    <div class="mt-2 flex justify-end">
                        <button id="clear-leichi"
                            class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-custom text-sm">
                            <i class="fa fa-trash mr-1"></i>清空
                        </button>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-700">或上传日志文件</label>
                    <label for="leichi-file"
                        class="flex items-center px-5 py-3 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200 transition-custom">
                        <i class="fa fa-upload mr-2 text-gray-600"></i>
                        <span class="text-gray-700">选择文件</span>
                    </label>
                    <input id="leichi-file" type="file" accept=".log,.txt" class="hidden" />
                    <span id="leichi-filename" class="ml-4 text-sm text-gray-500"></span>
                </div>

                <button id="analyze-leichi" class="px-6 py-3 card-button text-white rounded-lg flex items-center">
                    <i class="fa fa-search mr-2"></i>
                    分析雷池日志
                </button>
            </div>

            <div id="ncsa-content" class="card p-6 hidden">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-700">输入日志内容</label>
                    <textarea id="ncsa-log" rows="8" class="form-input resize-vertical"
                        placeholder="粘贴NCSA标准格式日志内容..."></textarea>
                    <div class="mt-2 flex justify-end">
                        <button id="clear-ncsa"
                            class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-custom text-sm">
                            <i class="fa fa-trash mr-1"></i>清空
                        </button>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-700">或上传日志文件</label>
                    <label for="ncsa-file"
                        class="flex items-center px-5 py-3 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200 transition-custom">
                        <i class="fa fa-upload mr-2 text-gray-600"></i>
                        <span class="text-gray-700">选择文件</span>
                    </label>
                    <input id="ncsa-file" type="file" accept=".log,.txt" class="hidden" />
                    <span id="ncsa-filename" class="ml-4 text-sm text-gray-500"></span>
                </div>

                <button id="analyze-ncsa" class="px-6 py-3 card-button text-white rounded-lg flex items-center">
                    <i class="fa fa-search mr-2"></i>
                    分析NCSA日志
                </button>
            </div>

            <div id="nginx-content" class="card p-6 hidden">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-700">输入IP段内容（可粘贴分析结果）</label>
                    <textarea id="nginx-ip-input" rows="8" class="form-input resize-vertical" placeholder="粘贴IP段内容，例如：
IP段:123.456.789.x(共7个IP)
123.456.789.21
123.456.789.23
..."></textarea>
                    <div class="mt-2 flex justify-end">
                        <button id="clear-nginx"
                            class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-custom text-sm">
                            <i class="fa fa-trash mr-1"></i>清空
                        </button>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-700">或上传IP段文件</label>
                    <label for="nginx-file"
                        class="flex items-center px-5 py-3 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200 transition-custom">
                        <i class="fa fa-upload mr-2 text-gray-600"></i>
                        <span class="text-gray-700">选择文件</span>
                    </label>
                    <input id="nginx-file" type="file" accept=".log,.txt" class="hidden" />
                    <span id="nginx-filename" class="ml-4 text-sm text-gray-500"></span>
                </div>

                <button id="convert-nginx" class="px-6 py-3 card-button text-white rounded-lg flex items-center">
                    <i class="fa fa-code mr-2"></i>
                    转换为Nginx配置
                </button>
            </div>
        </div>

        <div id="result-section" class="card p-6 hidden">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fa fa-list-alt text-primary mr-2"></i>分析结果
            </h2>

            <div class="mb-4 flex justify-between items-center">
                <p class="text-gray-700">共识别到 <span id="result-group-count" class="font-bold text-primary">0</span>
                    个IP段，总计 <span id="result-total-count" class="font-bold text-primary">0</span> 个回源IP地址</p>
                <button id="copy-results"
                    class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-custom flex items-center text-sm user-select-text">
                    <i class="fa fa-copy mr-1"></i>复制结果
                </button>
            </div>

            <div id="result-groups"
                class="border border-gray-200 rounded-lg p-4 overflow-y-auto bg-gray-50 max-h-[500px]">
            </div>

            <div id="copy-notification" class="mt-3 text-sm text-green-600 hidden flex items-center">
                <i class="fa fa-check-circle mr-1"></i> 已复制到剪贴板
            </div>
        </div>

        <div id="nginx-result-section" class="card p-6 hidden">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fa fa-code text-primary mr-2"></i>Nginx配置结果
            </h2>

            <div class="mb-4 flex justify-between items-center">
                <p class="text-gray-700">生成的Nginx配置可直接用于设置真实IP来源</p>
                <button id="copy-nginx-results"
                    class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-custom flex items-center text-sm">
                    <i class="fa fa-copy mr-1"></i>复制配置
                </button>
            </div>

            <div id="nginx-result-content"
                class="border border-gray-200 rounded-lg p-4 overflow-y-auto bg-gray-50 max-h-[400px] font-mono text-sm user-select-text">
            </div>

            <div id="nginx-copy-notification" class="mt-3 text-sm text-green-600 hidden flex items-center">
                <i class="fa fa-check-circle mr-1"></i> 配置已复制到剪贴板
            </div>
        </div>
    </main>

    <footer class="bg-white mt-12 border-t border-gray-200">
        <div class="container mx-auto px-4 py-6 text-center">
            <p class="text-gray-600 text-sm">©<span class="not-italic">
                    <script>
                        document.write(new Date().getFullYear())
                    </script>
                </span> <b> Rockaz.top</b>版权所有</p>
        </div>
    </footer>
    <!--此处JS代码已压缩格式，如需获取可自行解压-->
    <script>
        document.getElementById('tab-leichi').addEventListener('click',function(){document.getElementById('leichi-content').classList.remove('hidden');document.getElementById('ncsa-content').classList.add('hidden');document.getElementById('nginx-content').classList.add('hidden');document.getElementById('result-section').classList.add('hidden');document.getElementById('nginx-result-section').classList.add('hidden');this.classList.remove('text-gray-500');this.classList.add('text-primary','border-b-2','border-primary','font-bold');const ncsaTab=document.getElementById('tab-ncsa');ncsaTab.classList.remove('text-primary','border-b-2','border-primary','font-bold');ncsaTab.classList.add('text-gray-500','font-medium');const nginxTab=document.getElementById('tab-nginx');nginxTab.classList.remove('text-primary','border-b-2','border-primary','font-bold');nginxTab.classList.add('text-gray-500','font-medium');clearResults()});document.getElementById('tab-ncsa').addEventListener('click',function(){document.getElementById('ncsa-content').classList.remove('hidden');document.getElementById('leichi-content').classList.add('hidden');document.getElementById('nginx-content').classList.add('hidden');document.getElementById('result-section').classList.add('hidden');document.getElementById('nginx-result-section').classList.add('hidden');this.classList.remove('text-gray-500');this.classList.add('text-primary','border-b-2','border-primary','font-bold');const leichiTab=document.getElementById('tab-leichi');leichiTab.classList.remove('text-primary','border-b-2','border-primary','font-bold');leichiTab.classList.add('text-gray-500','font-medium');const nginxTab=document.getElementById('tab-nginx');nginxTab.classList.remove('text-primary','border-b-2','border-primary','font-bold');nginxTab.classList.add('text-gray-500','font-medium');clearResults()});document.getElementById('tab-nginx').addEventListener('click',function(){document.getElementById('nginx-content').classList.remove('hidden');document.getElementById('leichi-content').classList.add('hidden');document.getElementById('ncsa-content').classList.add('hidden');document.getElementById('result-section').classList.add('hidden');document.getElementById('nginx-result-section').classList.add('hidden');this.classList.remove('text-gray-500');this.classList.add('text-primary','border-b-2','border-primary','font-bold');const leichiTab=document.getElementById('tab-leichi');leichiTab.classList.remove('text-primary','border-b-2','border-primary','font-bold');leichiTab.classList.add('text-gray-500','font-medium');const ncsaTab=document.getElementById('tab-ncsa');ncsaTab.classList.remove('text-primary','border-b-2','border-primary','font-bold');ncsaTab.classList.add('text-gray-500','font-medium')});function handleFileUpload(fileInputId,textareaId,filenameDisplayId){const fileInput=document.getElementById(fileInputId);const textarea=document.getElementById(textareaId);const filenameDisplay=document.getElementById(filenameDisplayId);fileInput.addEventListener('change',function(e){if(this.files&&this.files[0]){const file=this.files[0];filenameDisplay.textContent=file.name;const reader=new FileReader();reader.onload=function(e){textarea.value=e.target.result};reader.readAsText(file)}})}handleFileUpload('leichi-file','leichi-log','leichi-filename');handleFileUpload('ncsa-file','ncsa-log','ncsa-filename');handleFileUpload('nginx-file','nginx-ip-input','nginx-filename');document.getElementById('clear-leichi').addEventListener('click',function(){document.getElementById('leichi-log').value='';document.getElementById('leichi-file').value='';document.getElementById('leichi-filename').textContent='';clearResults()});document.getElementById('clear-ncsa').addEventListener('click',function(){document.getElementById('ncsa-log').value='';document.getElementById('ncsa-file').value='';document.getElementById('ncsa-filename').textContent='';clearResults()});document.getElementById('clear-nginx').addEventListener('click',function(){document.getElementById('nginx-ip-input').value='';document.getElementById('nginx-file').value='';document.getElementById('nginx-filename').textContent='';document.getElementById('nginx-result-section').classList.add('hidden')});function clearResults(){const resultSection=document.getElementById('result-section');const resultGroupsContainer=document.getElementById('result-groups');const groupCountEl=document.getElementById('result-group-count');const totalCountEl=document.getElementById('result-total-count');resultGroupsContainer.innerHTML='';groupCountEl.textContent='0';totalCountEl.textContent='0';resultSection.classList.add('hidden')}const ipRegex=/\b(?:\d{1,3}\.){3}\d{1,3}\b/;document.getElementById('analyze-leichi').addEventListener('click',function(){const logContent=document.getElementById('leichi-log').value.trim();if(!logContent){alert('请输入或上传雷池WAF日志内容');return}const lines=logContent.split('\n');const allIps=new Set();lines.forEach(line=>{const parts=line.split('|');if(parts.length>0){const ipCandidate=parts[0].trim();if(ipRegex.test(ipCandidate)){allIps.add(ipCandidate)}}});const prefixGroups={};Array.from(allIps).forEach(ip=>{const parts=ip.split('.');if(parts.length===4){const prefix=`${parts[0]}.${parts[1]}.${parts[2]}`;if(!prefixGroups[prefix]){prefixGroups[prefix]=new Set()}prefixGroups[prefix].add(ip)}});const validGroups=[];Object.entries(prefixGroups).forEach(([prefix,ipsSet])=>{const ips=Array.from(ipsSet);if(ips.length>=5){validGroups.push({prefix:prefix,ips:ips.sort((a,b)=>{const aLast=parseInt(a.split('.')[3]);const bLast=parseInt(b.split('.')[3]);return aLast-bLast})})}});validGroups.sort((a,b)=>b.ips.length-a.ips.length);displayResults(validGroups)});document.getElementById('analyze-ncsa').addEventListener('click',function(){const logContent=document.getElementById('ncsa-log').value.trim();if(!logContent){alert('请输入或上传NCSA标准日志内容');return}const lines=logContent.split('\n');const allIps=new Set();lines.forEach(line=>{const match=line.match(ipRegex);if(match&&match[0]){allIps.add(match[0])}});if(allIps.size===0){alert('未在日志中找到有效的IP地址');return}const prefixGroups={};Array.from(allIps).forEach(ip=>{const parts=ip.split('.');if(parts.length===4){const prefix=`${parts[0]}.${parts[1]}.${parts[2]}`;if(!prefixGroups[prefix]){prefixGroups[prefix]=new Set()}prefixGroups[prefix].add(ip)}});const validGroups=[];Object.entries(prefixGroups).forEach(([prefix,ipsSet])=>{const ips=Array.from(ipsSet);if(ips.length>=5){validGroups.push({prefix:prefix,ips:ips.sort((a,b)=>{const aLast=parseInt(a.split('.')[3]);const bLast=parseInt(b.split('.')[3]);return aLast-bLast})})}});validGroups.sort((a,b)=>b.ips.length-a.ips.length);displayResults(validGroups)});document.getElementById('convert-nginx').addEventListener('click',function(){const ipContent=document.getElementById('nginx-ip-input').value.trim();if(!ipContent){alert('请输入IP段内容');return}const lines=ipContent.split('\n');const groups=[];let currentGroup=null;lines.forEach(line=>{line=line.trim();if(!line)return;const groupMatch=line.match(/IP段:([\d.]+)\.x\(共(\d+)个IP\)/);if(groupMatch){if(currentGroup){groups.push(currentGroup)}currentGroup={prefix:groupMatch[1],count:parseInt(groupMatch[2]),ips:[]}}else if(currentGroup&&ipRegex.test(line)){currentGroup.ips.push(line)}});if(currentGroup){groups.push(currentGroup)}if(groups.length===0){alert('未识别到有效的IP段内容，请检查输入格式');return}let nginxConfig='';groups.forEach(group=>{nginxConfig+=`#${group.prefix}.x段（${group.count}个IP）\n`;group.ips.forEach(ip=>{nginxConfig+=`set_real_ip_from ${ip}/32;\n`;});nginxConfig+='\n'});const resultContainer=document.getElementById('nginx-result-content');resultContainer.textContent=nginxConfig;document.getElementById('nginx-result-section').classList.remove('hidden');document.getElementById('nginx-result-section').scrollIntoView({behavior:'smooth',block:'start'})});function displayResults(groups){const resultSection=document.getElementById('result-section');const resultGroupsContainer=document.getElementById('result-groups');const groupCountEl=document.getElementById('result-group-count');const totalCountEl=document.getElementById('result-total-count');resultGroupsContainer.innerHTML='';const totalIps=groups.reduce((total,group)=>total+group.ips.length,0);groups.forEach((group,index)=>{const groupEl=document.createElement('div');groupEl.className=`mb-6 last:mb-0 ${index>0?'pt-6 border-t border-gray-200':''}`;const groupTitle=document.createElement('div');groupTitle.className='font-medium text-primary mb-3 flex items-center';groupTitle.innerHTML=`<i class="fa fa-server mr-2"></i>IP段:${group.prefix}.x(共${group.ips.length}个IP)`;groupEl.appendChild(groupTitle);const ipList=document.createElement('div');ipList.className='grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 ml-6';group.ips.forEach(ip=>{const ipEl=document.createElement('div');ipEl.className='py-2 px-4 bg-gray-100 rounded text-sm hover:bg-gray-200 transition-custom text-center text-gray-800';ipEl.textContent=ip;ipList.appendChild(ipEl)});groupEl.appendChild(ipList);resultGroupsContainer.appendChild(groupEl)});groupCountEl.textContent=groups.length;totalCountEl.textContent=totalIps;resultSection.classList.remove('hidden');resultSection.scrollIntoView({behavior:'smooth',block:'start'})}document.getElementById('copy-results').addEventListener('click',function(){const resultGroups=document.getElementById('result-groups');let textToCopy='';Array.from(resultGroups.children).forEach(groupEl=>{const titleEl=groupEl.querySelector('.font-medium');if(titleEl){textToCopy+=titleEl.textContent.trim()+'\n'}const ipEls=groupEl.querySelectorAll('.bg-gray-100');ipEls.forEach(ipEl=>{textToCopy+=ipEl.textContent.trim()+'\n'});textToCopy+='\n'});navigator.clipboard.writeText(textToCopy).then(()=>{const notification=document.getElementById('copy-notification');notification.classList.remove('hidden');setTimeout(()=>notification.classList.add('hidden'),2000)})});document.getElementById('copy-nginx-results').addEventListener('click',function(){const configContent=document.getElementById('nginx-result-content').textContent;if(!configContent)return;navigator.clipboard.writeText(configContent).then(()=>{const notification=document.getElementById('nginx-copy-notification');notification.classList.remove('hidden');setTimeout(()=>notification.classList.add('hidden'),2000)})});
    </script>
</body>

</html>
